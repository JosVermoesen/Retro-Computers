 name malloc.c
 text
 global _malloc
_malloc pshs u,y
 leay 2,s
 leas -L2,s
* Auto 4 nbytes
* Register 128 p
* Auto -4 q
* Auto -6 nu
* Begin expression - 49
 ldd 4,y
 addd #4
 addd #-1
 lsra
 rorb
 lsra
 rorb
 addd #1
 std -6,y
* Begin expression - 50
 ldx __allocp
 stx -4,y
 lbne L3
* Begin expression - 52
 ldx #__base
 stx -4,y
 stx __allocp
 stx __base
* Begin expression - 53
 ldd #0
 std __base+2
L3
* Begin expression - 60
 ldx -4,y
 ldu 0,x
L4
* Begin expression - 63
 ldd -6,y
 cmpd 2,u
 lbhi L7
* Begin expression - 66
 ldd -6,y
 cmpd 2,u
 lbne L8
* Begin expression - 69
 ldx -4,y
 stx 0,s
 ldx 0,u
 stx [0,s]
 lbra L9
L8
* Begin expression - 74
 ldd -6,y
 nega
 negb
 sbca #0
 addd 2,u
 std 2,u
* Begin expression - 75
 ldd 2,u
 lslb
 rola
 lslb
 rola
 leau d,u
* Begin expression - 76
 ldd -6,y
 std 2,u
L9
* Begin expression - 80
 ldx -4,y
 stx __allocp
* Begin expression - 83
 cmpu #0
 beq 10f
 leax 4,u
 bra 11f
10
 leax 0,u
11
 lbra L1
L7
* Begin expression - 91
 cmpu __allocp
 lbne L10
* Begin expression - 92
 ldd -6,y
 std 0,s
 jsr _morecor
 tfr d,x
 leau 0,x
 cmpu #0
 lbne L11
* Begin expression - 93
 ldx #0
 lbra L1
L11
L10
L6
* Begin expression - 94
 stu -4,y
 ldu 0,u
 lbra L4
L5
L1
L2 equ 6
 tfr x,d
 leas -2,y
 puls y,u,pc
_morecor pshs u,y
 leay 2,s
 leas -L13,s
* Auto 4 nu
* Auto -4 cp
* Register 128 up
* Auto -6 rnu
* Auto -8 bksz
* Begin expression - 134
 ldd #0
 std 0,s
 jsr _sbrk
 tfr d,x
 tfr x,d
 anda #$F
 std -6,y
 lbeq L14
* Begin expression - 135
 ldd #4096
 subd -6,y
 asra
 rorb
 asra
 rorb
 std -6,y
L14
* Begin expression - 136
 ldd ___msz
 asra
 rorb
 asra
 rorb
 std -8,y
* Begin expression - 137
 ldd -6,y
 cmpd 4,y
 lbhs L15
* Begin expression - 137
 ldd -8,y
 addd #-1
 addd 4,y
 std 0,s
 ldd -8,y
 jsr udiv
 std 0,s
 ldd -8,y
 jsr umul
 addd -6,y
 std -6,y
L15
* Begin expression - 138
 ldd -6,y
 lslb
 rola
 lslb
 rola
 std 0,s
 jsr _sbrk
 std -4,y
* Begin expression - 139
 ldx #-1
 cmpx -4,y
 lbne L16
* Begin expression - 140
 ldx #0
 lbra L12
L16
* Begin expression - 141
 ldu -4,y
* Begin expression - 142
 ldd -6,y
 std 2,u
* Begin expression - 143
 cmpu #0
 beq 10f
 leax 4,u
 bra 11f
10
 leax 0,u
11
 stx 0,s
 jsr _free
* Begin expression - 144
 ldx __allocp
L12
L13 equ 8
 tfr x,d
 leas -2,y
 puls y,u,pc
 data
 text
 end
