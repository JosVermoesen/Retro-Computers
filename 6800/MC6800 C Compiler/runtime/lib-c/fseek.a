 name fseek.c
 text
 global _fseek
_fseek pshs u,y
 leay 2,s
 leax -(L2+256),s
 cmpx stk_base
 bhs 1f
 jsr grows
1
 leas -L2,s
* Begin expression - 0
 ldu 4,y
* Register 128 stream
* Auto 6 offset
* Auto 10 type
* Auto -4 rtnval
* Auto -6 flag
* Begin expression - 74
 ldd 6,u
 andb #$EF
 std 6,u
* Begin expression - 75
 ldd #-1
 std 10,u
* Begin expression - 79
 ldd 6,u
 andb #$1
 lbeq 10f
 ldd 6,u
 clrb
 anda #$2
 lbeq 14f
10
 ldd 6,u
 clrb
 anda #$2
 lbeq 12f
 ldd 6,u
 clrb
 anda #$8
 lbne 14f
12
 ldd 6,u
 clrb
 anda #$2
 lbeq L3
 ldd 6,u
 clrb
 anda #$C
11
 lbne L3
14
* Begin expression - 81
 ldd 6,u
 andb #$4
 lbeq L4
* Begin expression - 84
 ldd #1
 pshs d
 clra
 clrb
 pshs d
 jsr neglong
 ldd 10,y
 pshs d
 leax 6,y
 jsr pshlong
 ldd 8,u
 pshs d
 jsr _lseek
 leas 8,s
 jsr pshlong
 jsr cmplong
 lbeq L5
* Begin expression - 85
 clra
 clrb
 std -4,y
 lbra L6
L5
* Begin expression - 87
 ldd #-1
 std -4,y
L6
 lbra L7
L4
* Begin expression - 92
 ldd 8,u
 std 0,s
 jsr _isatty
 addd #0
 lbeq L8
* Begin expression - 94
 ldd #13
 std _errno
* Begin expression - 95
 ldd #-1
 std -4,y
 lbra L9
L8
* Begin expression - 99
 ldd 10,y
 cmpd #1
 lbne L10
* Begin expression - 107
 ldd 6,u
 clrb
 anda #$2
 lbne L11
 leax 6,y
 jsr pshlong
 clra
 clrb
 pshs d
 pshs d
 jsr cmplong
 lbge 11f
 ldx 4,u
 tfr x,d
 stu 0,s
 subd [0,s]
 pshs d
 bmi 1f
 clra
 clrb
 bra 2f
1 ldd #$ffff
2 pshs d
 leax 6,y
 jsr pshlong
 jsr cmplong
 lble 14f
11
 leax 6,y
 jsr pshlong
 clra
 clrb
 pshs d
 pshs d
 jsr cmplong
 lblt L11
 ldd 2,u
 pshs d
 bmi 1f
 clra
 clrb
 bra 2f
1 ldd #$ffff
2 pshs d
 leax 6,y
 jsr pshlong
 jsr cmplong
10
 lblt L11
14
* Begin expression - 113
 clra
 clrb
 std -6,y
* Begin expression - 114
 leax 6,y
 jsr pshlong
 ldd 2,s
 leas 4,s
 nega
 negb
 sbca #0
 addd 2,u
 std 2,u
* Begin expression - 115
 leax 6,y
 jsr pshlong
 ldd 2,s
 leas 4,s
 ldx 0,u
 leax d,x
 stx 0,u
* Begin expression - 116
 clra
 clrb
 std -4,y
 lbra L12
L11
* Begin expression - 124
 ldd #116
 std -6,y
* Begin expression - 125
 ldd 2,u
 pshs d
 bmi 1f
 clra
 clrb
 bra 2f
1 ldd #$ffff
2 pshs d
 leax 6,y
 jsr pshlong
 jsr rsublong
 leax 6,y
 jsr asnlong
 leas 4,s
L12
 lbra L13
L10
* Begin expression - 128
 ldd #116
 std -6,y
L13
* Begin expression - 134
 ldd -6,y
 lbeq L14
* Begin expression - 136
 clra
 clrb
 std 2,u
* Begin expression - 137
 ldd #1
 pshs d
 clra
 clrb
 pshs d
 jsr neglong
 ldd 10,y
 pshs d
 leax 6,y
 jsr pshlong
 ldd 8,u
 pshs d
 jsr _lseek
 leas 8,s
 jsr pshlong
 jsr cmplong
 lbne L15
* Begin expression - 138
 ldd #-1
 std -4,y
 lbra L16
L15
* Begin expression - 140
 clra
 clrb
 std -4,y
L16
L14
L9
L7
 lbra L17
L3
* Begin expression - 147
 ldd 6,u
 andb #$2
 lbeq 10f
 ldd 6,u
 clrb
 anda #$2
 lbeq 13f
10
 ldd 6,u
 clrb
 anda #$2
 lbeq L18
 ldd 6,u
 clrb
 anda #$4
11
 lbeq L18
13
* Begin expression - 148
 ldd 8,u
 std 0,s
 jsr _isatty
 addd #0
 lbne L19
* Begin expression - 149
 stu 0,s
 jsr _fflush
 cmpd #-1
 lbeq L20
* Begin expression - 150
 ldd #1
 pshs d
 clra
 clrb
 pshs d
 jsr neglong
 ldd 10,y
 pshs d
 leax 6,y
 jsr pshlong
 ldd 8,u
 pshs d
 jsr _lseek
 leas 8,s
 jsr pshlong
 jsr cmplong
 lbeq L21
* Begin expression - 151
 clra
 clrb
 std -4,y
 lbra L22
L21
* Begin expression - 153
 ldd #-1
 std -4,y
L22
 lbra L23
L20
* Begin expression - 155
 ldd #-1
 std -4,y
L23
 lbra L24
L19
* Begin expression - 158
 ldd #13
 std _errno
* Begin expression - 159
 ldd #-1
 std -4,y
L24
 lbra L25
L18
* Begin expression - 163
 ldd #7
 std _errno
* Begin expression - 164
 ldd #-1
 std -4,y
L25
L17
* Begin expression - 167
 ldd 6,u
 anda #$F3
 std 6,u
* Begin expression - 173
 ldd -4,y
 cmpd #-1
 lbne L26
* Begin expression - 174
 ldd 6,u
 orb #$20
 std 6,u
L26
* Begin expression - 175
 ldd -4,y
L1
L2 equ 6
 leas -2,y
 puls y,u,pc
 global _ftell
_ftell pshs u,y
 leay 2,s
 leax -(L28+256),s
 cmpx stk_base
 bhs 1f
 jsr grows
1
 leas -L28,s
* Begin expression - 0
 ldu 4,y
* Register 128 stream
* Auto -6 rtnval
* Begin expression - 212
 ldd 6,u
 andb #$1
 lbeq 10f
 ldd 6,u
 clrb
 anda #$2
 lbeq 14f
10
 ldd 6,u
 clrb
 anda #$2
 lbeq 12f
 ldd 6,u
 clrb
 anda #$8
 lbne 14f
12
 ldd 6,u
 clrb
 anda #$2
 lbeq L29
 ldd 6,u
 clrb
 anda #$C
11
 lbne L29
14
* Begin expression - 219
 ldd #1
 pshs d
 clra
 clrb
 pshs d
 jsr neglong
 ldd #1
 pshs d
 clra
 clrb
 pshs d
 ldd 8,u
 pshs d
 jsr _lseek
 leas 6,s
 jsr pshlong
 leax -6,y
 jsr asnlong
 jsr cmplong
 lbeq L30
* Begin expression - 220
 ldd 6,u
 clra
 andb #$4
 lbne L31
* Begin expression - 221
 ldd 2,u
 pshs d
 bmi 1f
 clra
 clrb
 bra 2f
1 ldd #$ffff
2 pshs d
 leax -6,y
 jsr pshlong
 jsr rsublong
 leax -6,y
 jsr asnlong
 leas 4,s
L31
L30
 lbra L32
L29
* Begin expression - 224
 ldd 6,u
 andb #$2
 lbeq 10f
 ldd 6,u
 clrb
 anda #$2
 lbeq 13f
10
 ldd 6,u
 clrb
 anda #$2
 lbeq L33
 ldd 6,u
 clrb
 anda #$4
11
 lbeq L33
13
* Begin expression - 231
 ldd #1
 pshs d
 clra
 clrb
 pshs d
 jsr neglong
 ldd #1
 pshs d
 clra
 clrb
 pshs d
 ldd 8,u
 pshs d
 jsr _lseek
 leas 6,s
 jsr pshlong
 leax -6,y
 jsr asnlong
 jsr cmplong
 lbeq L34
* Begin expression - 232
 ldd 6,u
 clra
 andb #$4
 lbne L35
* Begin expression - 233
 ldx 0,u
 tfr x,d
 leax 4,u
 std 0,s
 pshs x
 subd [0,s]
 pshs d
 bmi 1f
 clra
 clrb
 bra 2f
1 ldd #$ffff
2 pshs d
 leax -6,y
 jsr pshlong
 jsr addlong
 leax -6,y
 jsr asnlong
 leas 4,s
L35
L34
 lbra L36
L33
 leas 2,s
* Begin expression - 241
 ldd #7
 std _errno
* Begin expression - 242
 ldd #1
 pshs d
 clra
 clrb
 pshs d
 jsr neglong
 leax -6,y
 jsr asnlong
 leas 4,s
L36
L32
* Begin expression - 248
 leax -6,y
 jsr pshlong
 ldx #L10001
 jsr asnlong
L27
L28 equ 6
 leas -2,y
 puls y,u,pc
 bss
L10001 rmb 4
 text
 global _rewind
_rewind pshs u,y
 leay 2,s
 leax -(L38+256),s
 cmpx stk_base
 bhs 1f
 jsr grows
1
 leas -L38,s
* Auto 4 stream
* Begin expression - 277
 clra
 clrb
 std 0,s
 clra
 clrb
 pshs d
 pshs d
 ldx 4,y
 pshs x
 jsr _fseek
 leas 6,s
L37
L38 equ 2
 leas -2,y
 puls y,u,pc
 data
 text
 end
