 name getcwd.c
 text
 global _getcwd
_getcwd pshs u,y
 leay 2,s
 leas -L2,s
* Auto 4 buf
* Auto 6 size
* Register 128 p
* Auto -4 q
* Auto -6 r
* Auto -8 pdir
* Auto -10 pent
* Auto -12 i
* Auto -14 cntr
* Auto -16 mtfd
* Auto -18 no_erro
* Begin expression - 75
 ldd #116
 std -18,y
* Auto -20 not_fou
* Begin expression - 76
 ldd #116
 std -20,y
* Auto -42 dot
* Auto -64 slash
* Auto -160 mt
* Auto -416 name
* Begin expression - 92
 ldd 6,y
 cmpd #256
 bge 10f
 bra 11f
10
 ldd #256
11
 addd #-2
 std -14,y
 lblt L3
 leax -42,y
 stx 0,s
 ldx #L4
 pshs x
 jsr _stat
 leas 2,s
 addd #0
 lbne L3
 leax -64,y
 stx 0,s
 ldx #L5
 pshs x
 jsr _stat
 leas 2,s
 addd #0
12
 lbne L3
* Begin expression - 94
 leau -160,y
* Begin expression - 95
 clr 0,-u
L6
* Begin expression - 96
 ldd -18,y
 lbeq L7
 ldd -40,y
 cmpd #1
10
 lbeq L7
* Begin expression - 98
 ldx #L9
 stx 0,s
 jsr _opendir
 tfr d,x
 stx -8,y
 lbeq L8
L10
* Begin expression - 105
 ldx -8,y
 stx 0,s
 jsr _readdir
 tfr d,x
 stx -10,y
 lbeq L11
 ldx -10,y
 ldd 0,x
 cmpd -40,y
10
 lbne L10
L11
* Begin expression - 106
 ldx -10,y
 lbeq L12
* Begin expression - 107
 ldx -10,y
 ldd 2,x
 addd #1
 nega
 negb
 sbca #0
 addd -14,y
 std -14,y
 lblt L13
* Begin expression - 113
 ldx -10,y
 ldd 2,x
 std -12,y
 ldx -10,y
 leax 4,x
 leax d,x
 stx -4,y
L14
* Begin expression - 114
 ldd -12,y
 subd #1
 std -12,y
 lblt L15
L16
* Begin expression - 114
 ldx -4,y
 ldb 0,-x
 stx -4,y
 stb 0,-u
 lbra L14
L15
* Begin expression - 115
 ldb #47
 stb 0,-u
* Begin expression - 119
 leax -42,y
 stx 0,s
 ldx -8,y
 ldd 0,x
 pshs d
 jsr _fstat
 leas 2,s
* Begin expression - 120
 ldx #L17
 stx 0,s
 jsr _chdir
 lbra L18
L13
* Begin expression - 123
 ldd #0
 std -18,y
L18
 lbra L19
L12
* Begin expression - 125
 ldd #0
 std -18,y
L19
* Begin expression - 126
 ldx -8,y
 stx 0,s
 jsr _closedi
 lbra L20
L8
* Begin expression - 129
 ldd #0
 std -18,y
L20
 lbra L6
L7
* Begin expression - 137
 leax 1,u
 stx 0,s
 jsr _chdir
 lbra L21
L3
* Begin expression - 140
 ldd #0
 std -18,y
L21
* Begin expression - 143
 ldd -18,y
 lbeq L22
* Begin expression - 149
 ldd -42,y
 cmpd -64,y
 lbeq L23
* Begin expression - 151
 ldd #0
 std 0,s
 ldx #L25
 pshs x
 jsr _open
 leas 2,s
 std -16,y
 cmpd #-1
 lbeq L24
L26
* Begin expression - 158
 ldd -20,y
 lbeq L27
 ldd #96
 std 0,s
 leax -160,y
 pshs x
 ldd -16,y
 pshs d
 jsr _read
 leas 4,s
 cmpd #96
10
 lbne L27
* Begin expression - 159
 ldd -42,y
 cmpd -160,y
 lbne L28
* Begin expression - 160
 ldd #0
 std -20,y
L28
 lbra L26
L27
* Begin expression - 161
 ldd -16,y
 std 0,s
 jsr _close
L24
* Begin expression - 169
 ldd -20,y
 beq 10f
 ldx #L29
 bra 11f
10
 leax -124,y
11
 stx -4,y
* Begin expression - 170
 ldx -4,y
 stx 0,s
 jsr _strlen
 std -12,y
 nega
 negb
 sbca #0
 addd -14,y
 std -14,y
 lblt L30
* Begin expression - 171
 ldd -12,y
 ldx -4,y
 leax d,x
 stx -4,y
L31
* Begin expression - 171
 ldd -12,y
 subd #1
 std -12,y
 lblt L32
L33
* Begin expression - 171
 ldx -4,y
 ldb 0,-x
 stx -4,y
 stb 0,-u
 lbra L31
L32
 lbra L34
L30
* Begin expression - 173
 ldd #0
 std -18,y
L34
 lbra L35
L23
* Begin expression - 176
 ldb 0,u
 lbne L36
* Begin expression - 177
 ldd -14,y
 subd #1
 std -14,y
 lblt L37
* Begin expression - 178
 ldb #47
 stb 0,-u
 lbra L38
L37
* Begin expression - 180
 ldd #0
 std -18,y
L38
L36
L35
 lbra L39
L22
* Begin expression - 183
 ldd #0
 std -18,y
L39
* Begin expression - 191
 ldd -18,y
 lbeq L40
* Begin expression - 193
 ldx 4,y
 lbne L41
* Begin expression - 194
 ldd 6,y
 std 0,s
 jsr _malloc
 tfr d,x
 stx -4,y
 stx -6,y
 bne 1f
 clra
 clrb
 bra 2f
1 ldd #1
2
 std -18,y
 lbra L42
L41
* Begin expression - 196
 ldx 4,y
 stx -4,y
 stx -6,y
L42
* Begin expression - 197
 ldd -18,y
 lbeq L43
L44
* Begin expression - 199
 ldb 0,u+
 ldx -4,y
 stb 0,x+
 stx -4,y
 tstb
 lbne L44
L45
* Begin expression - 200
 ldx -4,y
 ldb #13
 stb -1,x
* Begin expression - 201
 clr [-4,y]
L43
L40
* Begin expression - 204
 ldd -18,y
 beq 10f
 ldx -6,y
 bra 11f
10
 ldx #0
11
L1
L2 equ 416
 tfr x,d
 leas -2,y
 puls y,u,pc
 data
L4 fcb 46,0
L5 fcb 47,0
L9 fcb 46,46,0
L17 fcb 46,46,0
L25 fcb 47,101,116,99,47,109,116,97,98,0
L29 fcb 47,63,63,63,0
 text
 end
