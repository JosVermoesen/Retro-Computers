From 78120b576afc3e7c3ec134699f3777fea3dc5655 Mon Sep 17 00:00:00 2001
From: czietz <czietz@gmx.net>
Date: Sat, 3 Nov 2018 15:44:03 +0100
Subject: [PATCH 2/3] Slightly rewrite filled polygon drawing by clc_flit to
 generate faster code

---
 vdi/vdi_fill.c | 17 +++++++++--------
 1 file changed, 9 insertions(+), 8 deletions(-)

diff --git a/vdi/vdi_fill.c b/vdi/vdi_fill.c
index 5b6744a6..f7360b77 100644
--- a/vdi/vdi_fill.c
+++ b/vdi/vdi_fill.c
@@ -394,14 +394,11 @@ clc_flit (const VwkAttrib * attr, const VwkClip * clipper, const Point * point,
     bufptr = fill_buffer;
 
     /* find intersection points of scan line with poly edges. */
-    for (i = vectors - 1; i >= 0; i--) {
-        WORD x1, x2, y1, y2, dy;
+    for (i = 0; i <= vectors-1; i++) {
+        WORD y1, y2, dy;
 
-        x1 = point->x;          /* fetch x-value of 1st endpoint. */
-        y1 = point->y;          /* fetch y-value of 1st endpoint. */
-        point++;
-        x2 = point->x;          /* fetch x-value of 2nd endpoint. */
-        y2 = point->y;          /* fetch y-value of 2nd endpoint. */
+        y1 = point[i].y;        /* fetch y-value of 1st endpoint. */
+        y2 = point[i+1].y;      /* fetch y-value of 2nd endpoint. */
 
         /* if the current vector is horizontal, ignore it. */
         dy = y2 - y1;
@@ -421,7 +418,11 @@ clc_flit (const VwkAttrib * attr, const VwkClip * clipper, const Point * point,
              * test is found in Newman and Sproull.
              */
             if ((dy1 < 0) != (dy2 < 0)) {
-                int dx = (x2 - x1) << 1;    /* so we can round by adding 1 below */
+                int dx;
+                WORD x1, x2;
+                x1 = point[i].x;        /* fetch x-value of 1st endpoint. */
+                x2 = point[i+1].x;      /* fetch x-value of 2nd endpoint. */
+                dx = (x2 - x1) << 1;    /* so we can round by adding 1 below */
                 if (intersections >= MAX_INTERSECTIONS)
                     break;
                 intersections++;
-- 
2.17.0.windows.1

