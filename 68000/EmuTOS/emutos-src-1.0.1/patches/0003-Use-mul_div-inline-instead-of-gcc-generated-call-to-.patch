From 82155f0e01fa07bb4824a4a3618f62111c62f542 Mon Sep 17 00:00:00 2001
From: czietz <czietz@gmx.net>
Date: Tue, 6 Nov 2018 19:15:44 +0000
Subject: [PATCH 3/3] Use mul_div inline instead of gcc generated call to
 division function to speed up clc_flit

---
 vdi/vdi_fill.c | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/vdi/vdi_fill.c b/vdi/vdi_fill.c
index 28d14111..be667607 100644
--- a/vdi/vdi_fill.c
+++ b/vdi/vdi_fill.c
@@ -11,6 +11,7 @@
 
 #include "config.h"
 #include "portab.h"
+#include "intmath.h"
 #include "vdi_defs.h"
 #include "../bios/tosvars.h"
 #include "../bios/lineavars.h"
@@ -428,10 +429,12 @@ clc_flit (const VwkAttrib * attr, const VwkClip * clipper, const Point * point,
                 intersections++;
                 /* fill edge buffer with x-values */
                 if ( dx < 0 ) {
-                    *bufptr++ = ((dy2 * dx / dy + 1) >> 1) + x2;
+                    /* does ((dy2 * dx / dy + 1) >> 1) + x2; */
+                    *bufptr++ = ((mul_div(dy2, dx, dy) + 1) >> 1) + x2;
                 }
                 else {
-                    *bufptr++ = ((dy1 * dx / dy + 1) >> 1) + x1;
+                    /* does ((dy1 * dx / dy + 1) >> 1) + x1; */
+                    *bufptr++ = ((mul_div(dy1, dx, dy) + 1) >> 1) + x1;
                 }
             }
         }
-- 
2.17.0.windows.1

