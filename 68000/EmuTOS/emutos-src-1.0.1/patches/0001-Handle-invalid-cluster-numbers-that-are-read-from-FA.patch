From 1219420fecbd2664edf31f0f445e449bdd517357 Mon Sep 17 00:00:00 2001
From: czietz <czietz@gmx.net>
Date: Thu, 10 Jan 2019 18:04:53 +0000
Subject: [PATCH] Handle invalid cluster numbers that are read from FAT like
 the end of cluster chain

---
 bdos/fsfat.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/bdos/fsfat.c b/bdos/fsfat.c
index 9947905a..f7239c05 100644
--- a/bdos/fsfat.c
+++ b/bdos/fsfat.c
@@ -282,7 +282,7 @@ int nextcl(OFD *p, int wrtflg)
         }
     }
 
-    if (endofchain(cl2))
+    if (endofchain(cl2) || (cl2<2))
         return -1;
 
     p->o_curcl = cl2;
-- 
2.17.0.windows.1

