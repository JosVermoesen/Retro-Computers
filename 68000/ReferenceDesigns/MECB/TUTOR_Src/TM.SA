TM       IDNT      1,0       TM  Transparent mode                    12/28/81         XDEF      TMCMD SPC 1         XREF      FIXDCRLF         XREF      FNEXTF         XREF      GETSER1         XREF      GETSER2         XREF      MACSBUG         XREF      MD1CON         XREF      OUT1CR         XREF      PNT2HX         XREF.S    TMCHARSDELAYC1  EQU       $1000EOT      EQU       4         SECTION   10         MOVE.W    #$1801,TMCHARS      CNTLX,CNTL/A SPC 5*    TM  [[EXIT CHAR]TRAILING CHAR]**  In transparent mode the terminal is physically connected to the*  host; at the same time the terminal is watched by TM software*  for the EXIT character.  When the exit character is transmitted*  by the terminal it goes directly to the host; and at the same*  time the TM software reconfigures the hardware.  If a nonnull*  trailing character is present it is now sent via port 2 to*  the host. PAGE         SECTION   11*   TRANSPARENT MODE*TMCMD    LEA       P2CMD0(PC),A0         BSR       FNEXTF              FIND NEXT FIELD         MOVE.B    (A5)+,TMCHARS+1     QUIT CHARACTER         BSR       FNEXTF              FIND NEXT FIELD         MOVE.B    (A5)+,TMCHARS       OPTIONAL TRAILING CHARP2CMD0   MOVE.W    TMCHARS,D7         BSR       GETSER1              ADDRESS FOR PORT1 INTO A0         LEA       MSG006(PC),A5        "TRANSPARENT MODE"         BSR FIXDCRLF    SET UP FOR MESSAGE         MOVE.L D7,D0  EXIT CHARACTER         BSR PNT2HX   PRINT 2 HEX CHARACTERS         MOVE.W #' =',(A6)+         MOVE.B D7,D0         SEE IF CONTROL CHAR         CMP.B #' ',D0         BPL.S P2CMD01         MOVE.L #' CTL',(A6)+         ADD.B #64,D0         MAKE IT A PRINTABLE CHARACTERP2CMD01  MOVE.B #' ',(A6)+         MOVE.B D0,(A6)+         MOVE.W #$0D0A,(A6)+         BSR OUT1CR  GO PRINT BUFFER WITH CRLF SPC 1         MOVE.B MD1CON,D0 PROGRAM ACIA FOR TRANSPARENT MODE         AND.B #$9F,D0         OR.B #$40,D0 FORCE RTS HIGH         MOVE.B D0,0(A0)P2CMD2   BTST.B  #$0,0(A0)  READ STATUS         BEQ.S P2CMD2         MOVE.B 2(A0),D0      RECEIVE CHAR FROM PORT 1         AND.B #$7F,D0         CMP.B D7,D0  SEE IF QUIT CHARACTER (CTL A USUALLY)         BNE.S     P2CMD2         MOVE.B MD1CON,D0 REPROGRAM FOR NON-TRANSPARENT         AND.B #$9F,D0         MOVE.B D0,0(A0)         ASR.W #8,D7         TST.B D7         BEQ.S P2CMD6*        SPECIAL SECOND CHAR TO HOST SEQUENCE         MOVE.L #DELAYC1,D0P2CMD4   SUB.L #1,D0 DELAY; ALLOW HOST TO SYNC         BNE.S P2CMD4         BSR       GETSER2         MOVE.B D7,2(A0) SEND CHARP2CMD6   BRA MACSBUG SPC 1MSG006   DC.B      '*TRANSPARENT* EXIT=$',EOT SPC 3         END