; ramTest.asm
; Assembled with asm6809
; Land Boards, LLC
; Test RAM using LB-6809-01 on LB-MEM-02 card

RAMSTART	EQU $0000
RAMEND		EQU $0007
RAMENDPL1	EQU $8000

		ORG $C000
; SET LED = LOW
RESVEC	NOP
		LDU	#$7FFE	; SET USER STACK POINTER
; TEST WITH WRTE/READ OF ADDRESS $0000 AND VALUE OF $55
		LDA	#$55
		STA	RAMSTART
		NOP
		LDB	RAMSTART
		CMPB #$55
		BNE	FASTBLINK
; TEST WITH WRTE/READ OF ADDRESS $0000 AND VALUE OF $AA
		LDA	#$AA
		STA	RAMSTART
		NOP
		LDB	RAMSTART
		CMPB #$AA
		BNE	FASTBLINK
; BOUNCE A BIT ACROSS THE DATA LINES OF ADDR $0000
		LDA #$01
LOOP1ADR
		STA RAMSTART
		NOP
		CMPA RAMSTART
		BNE	FASTBLINK
		ASLA
		CMPA #$00
		BNE	LOOP1ADR
; Fill memory with a ramp value
		LDX #RAMSTART
		LDA #0
		LDB #1
LPSTORE
		STA 0,X
		ABX
		INCA
		CMPX	#RAMENDPL1
		BNE	LPSTORE
; CHECK RAMP VALUES
		LDX #RAMSTART
		LDA #0
		LDB #1
LPCHECK
		CMPA	0,X
		BNE	FASTBLINK
		ABX
		INCA
		CMPX	#RAMENDPL1
		BNE	LPCHECK
;
; CHECK UPPER ADDRESS LINES
;
		LDA	#1			; UPPER BYTE OF D
		LDB	#0			; LOWER BYTE OF D
LOOPBITWR
		TFR	D,X
		STA	0,X
		ADDA	#1
		CMPA	#80
		BNE		LOOPBITWR
; 
		LDA	#1			; UPPER BYTE OF D
		LDB	#0			; LOWER BYTE OF D
LOOPBITRD
		TFR	D,X
		CMPA	0,X
		BNE	FASTBLINK
		ADDA	#1
		CMPA	#80
		BNE		LOOPBITRD
		
		
; DEFAULT = PASS
		BRA	SLOWBLINK

;
; Slowly blink LED
;
FASTBLINK
		CLRA
		STA	$F000
; WAIT LOOP
		LDA	#$40
LOOPX1
		LDB	#$FF
LOOPX1B
		NOP
		DECB
		BNE LOOPX1B
		DECA
		BNE	LOOPX1
; SET LED = HIGH
		LDA	#$1
		STA	$F000
; WAIT LOOP
		LDA	#$FF
LOOPX2
		LDB	#$40
LOOPX2B
		NOP
		DECB
		BNE LOOPX2B
		DECA
		BNE	LOOPX2
; LOOP FOREVER
		BRA	FASTBLINK

;
; Slowly blink LED
;
SLOWBLINK
		CLRA
		STA	$F000
; WAIT LOOP
		LDA	#$FF
LOOP1
		LDB	#$FF
LOOP1B
		NOP
		DECB
		BNE LOOP1B
		DECA
		BNE	LOOP1
; SET LED = HIGH
		LDA	#$1
		STA	$F000
; WAIT LOOP
		LDA	#$FF
LOOP2
		LDB	#$FF
LOOP2B
		NOP
		DECB
		BNE LOOP2B
		DECA
		BNE	LOOP2
; LOOP FOREVER
		BRA	SLOWBLINK

; Reset vector
		ORG	$FFFE
LBFFE	FDB	RESVEC	; RESET 
